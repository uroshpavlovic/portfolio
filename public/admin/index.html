<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
</head>
<body>
  <script src="https://unpkg.com/@sveltia/cms/dist/sveltia-cms.js"></script>
  <script>
    // Inject the full preview stylesheet into the CMS preview iframe
    CMS.registerPreviewStyle('/admin/preview.css');

    var ProjectPreview = createClass({
      render: function () {
        var entry = this.props.entry;
        var title = entry.getIn(['data', 'title']) || '';
        var coverImage = entry.getIn(['data', 'coverImage']);
        var client = entry.getIn(['data', 'client']);
        var year = entry.getIn(['data', 'year']);
        var description = entry.getIn(['data', 'description']);
        var gallery = entry.getIn(['data', 'gallery']);
        var getAsset = this.props.getAsset;

        // Build gallery rows (same structure as the actual project page)
        var galleryRows = [];
        if (gallery && gallery.size > 0) {
          galleryRows = gallery.map(function (row, i) {
            var layout = row.get('layout') || 'single';
            var image1 = row.get('image1');
            var image2 = row.get('image2');
            var rowClass = 'project-gallery-row' + (layout === 'double' ? ' double' : '');

            return h('div', { key: i, className: rowClass },
              image1 ? h('img', { src: getAsset(image1).toString() }) : null,
              layout === 'double' && image2 ? h('img', { src: getAsset(image2).toString() }) : null
            );
          }).toArray();
        }

        // Mirror the actual project detail page layout:
        //   .project-layout > .project-images + .project-info
        return h('div', { className: 'project-layout' },

          // Left column — images
          h('div', { className: 'project-images' },
            coverImage
              ? h('img', { className: 'project-cover', src: getAsset(coverImage).toString() })
              : null,
            galleryRows.length > 0 ? galleryRows : null
          ),

          // Right column — info
          h('div', { className: 'project-info' },
            h('h1', { className: 'project-title' },
              title.split('\n').map(function (line, i) {
                return h('span', { key: i }, line, i < title.split('\n').length - 1 ? h('br') : null);
              })
            ),

            description && description.size > 0
              ? h('div', { className: 'project-description' },
                  description.map(function (paragraph, i) {
                    return h('p', { key: i }, paragraph);
                  }).toArray()
                )
              : null,

            h('div', { className: 'project-meta' },
              client ? h('p', {}, 'Client: ' + client) : null,
              year ? h('p', {}, 'Year: ' + year) : null
            )
          )
        );
      }
    });

    CMS.registerPreviewTemplate('projects', ProjectPreview);
  </script>
</body>
</html>
